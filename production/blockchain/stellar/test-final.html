<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Stellar2 ìµœì¢… í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .test-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #08B5E5; }
    h2 { color: #333; margin-bottom: 15px; }
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .test-item {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
    }
    .success { color: #4CAF50; font-weight: bold; }
    .error { color: #F44336; font-weight: bold; }
    .warning { color: #FF9800; font-weight: bold; }
    .info { color: #2196F3; }
    button {
      background: #08B5E5;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #0691B7;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸš€ Stellar2 ëª¨ë“ˆ ìµœì¢… í…ŒìŠ¤íŠ¸</h1>
    <p>Bitcoin, Ethereum, Solana, Cosmos, Suiì™€ ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>

    <div class="test-section">
      <h2>âœ… ìˆ˜ì • ì™„ë£Œ ì‚¬í•­</h2>
      <ul>
        <li class="success">âœ“ send.jsì˜ showToast ì¤‘ë³µ ì„ ì–¸ ì˜¤ë¥˜ í•´ê²°</li>
        <li class="success">âœ“ ì„¤ì • ì•„ì´ì½˜ SVG íŒŒì¼ ì¶”ê°€ (assets/images/settings.svg)</li>
        <li class="success">âœ“ ì „ì²´ CSS íŒŒì¼ Bitcoinê³¼ í†µì¼ (ìƒ‰ìƒë§Œ Stellarë¡œ ë³€ê²½)</li>
        <li class="success">âœ“ HTML êµ¬ì¡° ì˜ì–´ ì£¼ì„ìœ¼ë¡œ í†µì¼</li>
        <li class="success">âœ“ ë‹ˆëª¨ë‹‰ í”Œë¡œìš° ì¶”ê°€ ë° Stellar ì–´ëŒ‘í„° ì—°ê²°</li>
        <li class="success">âœ“ Toast ë©”ì‹œì§€ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë¬¸ì œ í•´ê²°</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>1. íŒŒì¼ êµ¬ì¡° í…ŒìŠ¤íŠ¸</h2>
      <button onclick="testFileStructure()">íŒŒì¼ êµ¬ì¡° í™•ì¸</button>
      <div id="structure-result" class="result"></div>
    </div>

    <div class="test-section">
      <h2>2. ë©”ì¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸</h2>
      <button onclick="testMainPage()">ë©”ì¸ í˜ì´ì§€ ë¡œë“œ</button>
      <div id="main-result" class="result"></div>
      <div id="main-iframe"></div>
    </div>

    <div class="test-section">
      <h2>3. ê° í˜ì´ì§€ ì˜¤ë¥˜ í™•ì¸</h2>
      <div class="test-grid">
        <div class="test-item">
          <h3>Send Page</h3>
          <button onclick="testPage('send')">í…ŒìŠ¤íŠ¸</button>
          <div id="send-errors" class="result"></div>
        </div>
        <div class="test-item">
          <h3>Receive Page</h3>
          <button onclick="testPage('receive')">í…ŒìŠ¤íŠ¸</button>
          <div id="receive-errors" class="result"></div>
        </div>
        <div class="test-item">
          <h3>Settings Page</h3>
          <button onclick="testPage('settings')">í…ŒìŠ¤íŠ¸</button>
          <div id="settings-errors" class="result"></div>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>4. Toast ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸</h2>
      <button onclick="testToastVisibility()">Toast í‘œì‹œ í…ŒìŠ¤íŠ¸</button>
      <div id="toast-result" class="result"></div>
    </div>

    <div class="test-section">
      <h2>5. ìŠ¤íƒ€ì¼ ì¼ê´€ì„± í…ŒìŠ¤íŠ¸</h2>
      <button onclick="testStyleConsistency()">ìŠ¤íƒ€ì¼ í™•ì¸</button>
      <div id="style-result" class="result"></div>
    </div>
  </div>

  <script>
    // 1. íŒŒì¼ êµ¬ì¡° í…ŒìŠ¤íŠ¸
    async function testFileStructure() {
      const result = document.getElementById('structure-result');
      result.innerHTML = 'í™•ì¸ ì¤‘...';

      const requiredFiles = [
        'app.js',
        'app.css',
        'utils/config.js',
        'utils/helpers.js',
        'utils/storage.js',
        'assets/images/settings.svg',
        'assets/stellar-bundle.iife.js',
        'pages/index/index.html',
        'pages/index/index.js',
        'pages/index/index.css',
        'pages/index/mnemonic/mnemonic-flow.js',
        'pages/send/send.html',
        'pages/send/send.js',
        'pages/send/send.css',
        'pages/receive/receive.html',
        'pages/receive/receive.js',
        'pages/receive/receive.css',
        'pages/settings/settings.html',
        'pages/settings/settings.js',
        'pages/settings/settings.css'
      ];

      const checks = [];
      for (const file of requiredFiles) {
        try {
          const response = await fetch(file, { method: 'HEAD' });
          if (response.ok) {
            checks.push(`<span class="success">âœ“</span> ${file}`);
          } else {
            checks.push(`<span class="error">âœ—</span> ${file} (${response.status})`);
          }
        } catch (error) {
          checks.push(`<span class="error">âœ—</span> ${file} (ì—ëŸ¬)`);
        }
      }

      // index.htmlì´ ë£¨íŠ¸ì— ì—†ì–´ì•¼ í•¨
      try {
        const response = await fetch('index.html', { method: 'HEAD' });
        if (!response.ok) {
          checks.push(`<span class="success">âœ“</span> ë£¨íŠ¸ index.html ì—†ìŒ (ì •ìƒ)`);
        } else {
          checks.push(`<span class="error">âœ—</span> ë£¨íŠ¸ index.html ì¡´ì¬ (ì œê±° í•„ìš”)`);
        }
      } catch {
        checks.push(`<span class="success">âœ“</span> ë£¨íŠ¸ index.html ì—†ìŒ (ì •ìƒ)`);
      }

      result.innerHTML = checks.join('<br>');
    }

    // 2. ë©”ì¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
    function testMainPage() {
      const result = document.getElementById('main-result');
      const container = document.getElementById('main-iframe');

      result.innerHTML = 'í˜ì´ì§€ ë¡œë”© ì¤‘...';
      container.innerHTML = '';

      const iframe = document.createElement('iframe');
      iframe.src = 'pages/index/index.html';

      iframe.onload = () => {
        setTimeout(() => {
          const win = iframe.contentWindow;
          const checks = [];

          // Console ì—ëŸ¬ ì²´í¬ë¥¼ ìœ„í•œ proxy
          const originalError = win.console.error;
          let errorCount = 0;
          win.console.error = function() {
            errorCount++;
            originalError.apply(win.console, arguments);
          };

          // ì£¼ìš” í•¨ìˆ˜ë“¤ í™•ì¸
          const functions = [
            'createWallet',
            'importFromMnemonic',
            'startMnemonicFlow',
            'copyAddress',
            'navigateToSend',
            'navigateToReceive',
            'navigateToSettings'
          ];

          for (const func of functions) {
            if (typeof win[func] === 'function') {
              checks.push(`<span class="success">âœ“</span> ${func} í•¨ìˆ˜ ì •ì˜ë¨`);
            } else {
              checks.push(`<span class="error">âœ—</span> ${func} í•¨ìˆ˜ ì—†ìŒ`);
            }
          }

          // showToast ì¤‘ë³µ í™•ì¸
          if (typeof win.showToast === 'undefined') {
            checks.push(`<span class="success">âœ“</span> showToast ì¤‘ë³µ ì„ ì–¸ ì—†ìŒ`);
          } else {
            checks.push(`<span class="error">âœ—</span> showToastê°€ ì „ì—­ì— ì„ ì–¸ë¨`);
          }

          // StellarUtils í™•ì¸
          if (win.StellarUtils && win.StellarUtils.showToast) {
            checks.push(`<span class="success">âœ“</span> StellarUtils.showToast ì‚¬ìš© ê°€ëŠ¥`);
          } else {
            checks.push(`<span class="warning">âš </span> StellarUtils.showToast ì—†ìŒ`);
          }

          result.innerHTML = checks.join('<br>') +
            `<br><br>ì½˜ì†” ì—ëŸ¬: ${errorCount}ê°œ`;
        }, 1500);
      };

      container.appendChild(iframe);
    }

    // 3. ê° í˜ì´ì§€ ì˜¤ë¥˜ í™•ì¸
    function testPage(pageName) {
      const result = document.getElementById(`${pageName}-errors`);
      result.innerHTML = 'í™•ì¸ ì¤‘...';

      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = `pages/${pageName}/${pageName}.html`;
      document.body.appendChild(iframe);

      iframe.onload = () => {
        setTimeout(() => {
          const win = iframe.contentWindow;
          let errors = [];

          // Console ì—ëŸ¬ ìºì¹˜
          const originalError = win.console.error;
          win.console.error = function(msg) {
            errors.push(msg);
            originalError.apply(win.console, arguments);
          };

          // í•„ìˆ˜ í•¨ìˆ˜ í™•ì¸
          const requiredFunctions = {
            send: ['goBack', 'confirmSend', 'scanQRCode'],
            receive: ['goBack', 'copyAddress', 'fundTestAccount'],
            settings: ['navigateBack', 'showRecoveryPhrase', 'deleteWallet']
          };

          const funcs = requiredFunctions[pageName] || [];
          for (const func of funcs) {
            if (typeof win[func] !== 'function') {
              errors.push(`${func} í•¨ìˆ˜ ì—†ìŒ`);
            }
          }

          if (errors.length === 0) {
            result.innerHTML = '<span class="success">âœ“ ì˜¤ë¥˜ ì—†ìŒ</span>';
          } else {
            result.innerHTML = '<span class="error">ì˜¤ë¥˜ ë°œê²¬:</span><br>' +
              errors.map(e => `- ${e}`).join('<br>');
          }

          document.body.removeChild(iframe);
        }, 1000);
      };
    }

    // 4. Toast í…ŒìŠ¤íŠ¸
    async function testToastVisibility() {
      const result = document.getElementById('toast-result');
      result.innerHTML = 'Toast í…ŒìŠ¤íŠ¸ ì¤‘...';

      // í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
      const scripts = [
        'assets/stellar-bundle.iife.js',
        'utils/config.js',
        'utils/storage.js',
        'utils/helpers.js',
        'app.js'
      ];

      for (const src of scripts) {
        if (!document.querySelector(`script[src="${src}"]`)) {
          const script = document.createElement('script');
          script.src = src;
          document.head.appendChild(script);
          await new Promise(resolve => script.onload = resolve);
        }
      }

      setTimeout(() => {
        if (window.StellarUtils && window.StellarUtils.showToast) {
          // Toast ìƒì„±
          window.StellarUtils.showToast('í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤', 'success');

          setTimeout(() => {
            const toast = document.querySelector('.toast');
            if (toast) {
              const styles = window.getComputedStyle(toast);
              const bgColor = styles.backgroundColor;
              const textColor = styles.color;

              result.innerHTML = `
                <span class="success">âœ“ Toast ìƒì„±ë¨</span><br>
                ë°°ê²½ìƒ‰: ${bgColor}<br>
                í…ìŠ¤íŠ¸ìƒ‰: ${textColor}<br>
                ${textColor === 'rgb(255, 255, 255)' || textColor === 'white' ?
                  '<span class="success">âœ“ í…ìŠ¤íŠ¸ê°€ ë³´ì…ë‹ˆë‹¤</span>' :
                  '<span class="error">âœ— í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë¬¸ì œ</span>'}
              `;
            } else {
              result.innerHTML = '<span class="error">âœ— Toast ìƒì„± ì‹¤íŒ¨</span>';
            }
          }, 100);
        } else {
          result.innerHTML = '<span class="error">âœ— showToast í•¨ìˆ˜ ì—†ìŒ</span>';
        }
      }, 500);
    }

    // 5. ìŠ¤íƒ€ì¼ ì¼ê´€ì„± í…ŒìŠ¤íŠ¸
    async function testStyleConsistency() {
      const result = document.getElementById('style-result');
      result.innerHTML = 'ìŠ¤íƒ€ì¼ í™•ì¸ ì¤‘...';

      // CSS íŒŒì¼ í™•ì¸
      const cssFiles = [
        'app.css',
        'pages/index/index.css',
        'pages/send/send.css',
        'pages/receive/receive.css',
        'pages/settings/settings.css'
      ];

      const checks = [];

      // CSS ë³€ìˆ˜ í™•ì¸
      const testDiv = document.createElement('div');
      document.body.appendChild(testDiv);

      const rootStyles = getComputedStyle(document.documentElement);
      const primaryColor = rootStyles.getPropertyValue('--coin-primary').trim();
      const secondaryColor = rootStyles.getPropertyValue('--coin-secondary').trim();

      if (primaryColor === '#08B5E5') {
        checks.push('<span class="success">âœ“</span> Primary ìƒ‰ìƒ ì˜¬ë°”ë¦„ (#08B5E5)');
      } else {
        checks.push(`<span class="error">âœ—</span> Primary ìƒ‰ìƒ í‹€ë¦¼: ${primaryColor}`);
      }

      if (secondaryColor === '#000000') {
        checks.push('<span class="success">âœ“</span> Secondary ìƒ‰ìƒ ì˜¬ë°”ë¦„ (#000000)');
      } else {
        checks.push(`<span class="error">âœ—</span> Secondary ìƒ‰ìƒ í‹€ë¦¼: ${secondaryColor}`);
      }

      document.body.removeChild(testDiv);

      // CSS íŒŒì¼ ì¡´ì¬ í™•ì¸
      for (const file of cssFiles) {
        try {
          const response = await fetch(file);
          if (response.ok) {
            const text = await response.text();
            if (text.length > 100) {
              checks.push(`<span class="success">âœ“</span> ${file} ë¡œë“œë¨`);
            } else {
              checks.push(`<span class="warning">âš </span> ${file} ë‚´ìš© ë¶€ì¡±`);
            }
          } else {
            checks.push(`<span class="error">âœ—</span> ${file} ë¡œë“œ ì‹¤íŒ¨`);
          }
        } catch {
          checks.push(`<span class="error">âœ—</span> ${file} ì ‘ê·¼ ë¶ˆê°€`);
        }
      }

      result.innerHTML = checks.join('<br>');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Stellar2 ìµœì¢… í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
    });
  </script>
</body>
</html>